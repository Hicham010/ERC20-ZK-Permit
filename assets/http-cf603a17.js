import{c as p,e as j,f as b}from"./index-18a5c0bd.js";import{t as z}from"./tslib-af301d6d.js";var o={};Object.defineProperty(o,"__esModule",{value:!0});var Q=o.getLocalStorage=vt=o.getLocalStorageOrThrow=lt=o.getCrypto=ht=o.getCryptoOrThrow=gt=o.getLocation=at=o.getLocationOrThrow=it=o.getNavigator=ot=o.getNavigatorOrThrow=nt=o.getDocument=tt=o.getDocumentOrThrow=Y=o.getFromWindowOrThrow=K=o.getFromWindow=void 0;function l(e){let t;return typeof window<"u"&&typeof window[e]<"u"&&(t=window[e]),t}var K=o.getFromWindow=l;function v(e){const t=l(e);if(!t)throw new Error(`${e} is not defined in Window`);return t}var Y=o.getFromWindowOrThrow=v;function Z(){return v("document")}var tt=o.getDocumentOrThrow=Z;function et(){return l("document")}var nt=o.getDocument=et;function rt(){return v("navigator")}var ot=o.getNavigatorOrThrow=rt;function st(){return l("navigator")}var it=o.getNavigator=st;function ct(){return v("location")}var at=o.getLocationOrThrow=ct;function ut(){return l("location")}var gt=o.getLocation=ut;function ft(){return v("crypto")}var ht=o.getCryptoOrThrow=ft;function dt(){return l("crypto")}var lt=o.getCrypto=dt;function pt(){return v("localStorage")}var vt=o.getLocalStorageOrThrow=pt;function wt(){return l("localStorage")}Q=o.getLocalStorage=wt;var T={};Object.defineProperty(T,"__esModule",{value:!0});var mt=T.getWindowMetadata=void 0;const L=o;function Et(){let e,t;try{e=L.getDocumentOrThrow(),t=L.getLocationOrThrow()}catch{return null}function n(){const a=e.getElementsByTagName("link"),h=[];for(let d=0;d<a.length;d++){const m=a[d],E=m.getAttribute("rel");if(E&&E.toLowerCase().indexOf("icon")>-1){const c=m.getAttribute("href");if(c)if(c.toLowerCase().indexOf("https:")===-1&&c.toLowerCase().indexOf("http:")===-1&&c.indexOf("//")!==0){let y=t.protocol+"//"+t.host;if(c.indexOf("/")===0)y+=c;else{const C=t.pathname.split("/");C.pop();const X=C.join("/");y+=X+"/"+c}h.push(y)}else if(c.indexOf("//")===0){const y=t.protocol+c;h.push(y)}else h.push(c)}}return h}function r(...a){const h=e.getElementsByTagName("meta");for(let d=0;d<h.length;d++){const m=h[d],E=["itemprop","property","name"].map(c=>m.getAttribute(c)).filter(c=>c?a.includes(c):!1);if(E.length&&E){const c=m.getAttribute("content");if(c)return c}}return""}function i(){let a=r("name","og:site_name","og:title","twitter:title");return a||(a=e.title),a}function s(){return r("description","og:description","twitter:description","keywords")}const u=i(),w=s(),k=t.origin,G=n();return{description:w,url:k,icons:G,name:u}}mt=T.getWindowMetadata=Et;var Yt=e=>encodeURIComponent(e).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`),U="%[a-f0-9]{2}",S=new RegExp("("+U+")|([^%]+?)","gi"),A=new RegExp("("+U+")+","gi");function O(e,t){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;t=t||1;var n=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],O(n),O(r))}function yt(e){try{return decodeURIComponent(e)}catch{for(var t=e.match(S)||[],n=1;n<t.length;n++)e=O(t,n).join(""),t=e.match(S)||[];return e}}function Rt(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=A.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch{var r=yt(n[0]);r!==n[0]&&(t[n[0]]=r)}n=A.exec(e)}t["%C2"]="�";for(var i=Object.keys(t),s=0;s<i.length;s++){var u=i[s];e=e.replace(new RegExp(u,"g"),t[u])}return e}var Zt=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch{return Rt(e)}},te=(e,t)=>{if(!(typeof e=="string"&&typeof t=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t==="")return[e];const n=e.indexOf(t);return n===-1?[e]:[e.slice(0,n),e.slice(n+t.length)]},ee=function(e,t){for(var n={},r=Object.keys(e),i=Array.isArray(t),s=0;s<r.length;s++){var u=r[s],w=e[u];(i?t.indexOf(u)!==-1:t(u,w,e))&&(n[u]=w)}return n};const Ot=e=>JSON.stringify(e,(t,n)=>typeof n=="bigint"?n.toString()+"n":n),Tt=e=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=e.replace(t,'$1"$2n"$3');return JSON.parse(n,(r,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function _t(e){if(typeof e!="string")throw new Error(`Cannot safe json parse value of type ${typeof e}`);try{return Tt(e)}catch{return e}}function F(e){return typeof e=="string"?e:Ot(e)||""}const Ct="PARSE_ERROR",bt="INVALID_REQUEST",Lt="METHOD_NOT_FOUND",St="INVALID_PARAMS",B="INTERNAL_ERROR",_="SERVER_ERROR",At=[-32700,-32600,-32601,-32602,-32603],R={[Ct]:{code:-32700,message:"Parse error"},[bt]:{code:-32600,message:"Invalid Request"},[Lt]:{code:-32601,message:"Method not found"},[St]:{code:-32602,message:"Invalid params"},[B]:{code:-32603,message:"Internal error"},[_]:{code:-32e3,message:"Server error"}},J=_;function Ft(e){return At.includes(e)}function N(e){return Object.keys(R).includes(e)?R[e]:R[J]}function Nt(e){const t=Object.values(R).find(n=>n.code===e);return t||R[J]}function Dt(e,t,n){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${t}`):e}var xt={},g={},D;function Pt(){if(D)return g;D=1,Object.defineProperty(g,"__esModule",{value:!0}),g.isBrowserCryptoAvailable=g.getSubtleCrypto=g.getBrowerCrypto=void 0;function e(){return(p===null||p===void 0?void 0:p.crypto)||(p===null||p===void 0?void 0:p.msCrypto)||{}}g.getBrowerCrypto=e;function t(){const r=e();return r.subtle||r.webkitSubtle}g.getSubtleCrypto=t;function n(){return!!e()&&!!t()}return g.isBrowserCryptoAvailable=n,g}var f={},x;function Mt(){if(x)return f;x=1,Object.defineProperty(f,"__esModule",{value:!0}),f.isBrowser=f.isNode=f.isReactNative=void 0;function e(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}f.isReactNative=e;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}f.isNode=t;function n(){return!e()&&!t()}return f.isBrowser=n,f}(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=z;t.__exportStar(Pt(),e),t.__exportStar(Mt(),e)})(xt);function $(e=3){const t=Date.now()*Math.pow(10,e),n=Math.floor(Math.random()*Math.pow(10,e));return t+n}function It(e=6){return BigInt($(e))}function jt(e,t,n){return{id:n||$(),jsonrpc:"2.0",method:e,params:t}}function ne(e,t){return{id:e,jsonrpc:"2.0",result:t}}function Ut(e,t,n){return{id:e,jsonrpc:"2.0",error:Bt(t,n)}}function Bt(e,t){return typeof e>"u"?N(B):(typeof e=="string"&&(e=Object.assign(Object.assign({},N(_)),{message:e})),typeof t<"u"&&(e.data=t),Ft(e.code)&&(e=Nt(e.code)),e)}class W{}class re extends W{constructor(t){super()}}class Jt extends W{constructor(){super()}}class $t extends Jt{constructor(t){super()}}const Wt="^https?:",Ht="^wss?:";function qt(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function H(e,t){const n=qt(e);return typeof n>"u"?!1:new RegExp(t).test(n)}function P(e){return H(e,Wt)}function oe(e){return H(e,Ht)}function se(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}function q(e){return typeof e=="object"&&"id"in e&&"jsonrpc"in e&&e.jsonrpc==="2.0"}function ie(e){return q(e)&&"method"in e}function Vt(e){return q(e)&&(kt(e)||V(e))}function kt(e){return"result"in e}function V(e){return"error"in e}class ce extends $t{constructor(t){super(t),this.events=new j.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async request(t,n){return this.requestStrict(jt(t.method,t.params||[],It().toString()),n)}async requestStrict(t,n){return new Promise(async(r,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${t.id}`,s=>{V(s)?i(s.error):r(s.result)});try{await this.connection.send(t,n)}catch(s){i(s)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Vt(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Gt={Accept:"application/json","Content-Type":"application/json"},Xt="POST",M={headers:Gt,method:Xt},I=10;class ae{constructor(t){if(this.url=t,this.events=new j.EventEmitter,this.isAvailable=!1,this.registering=!1,!P(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t,n){this.isAvailable||await this.register();try{const r=F(t),s=await(await b(this.url,Object.assign(Object.assign({},M),{body:r}))).json();this.onPayload({data:s})}catch(r){this.onError(t.id,r)}}async register(t=this.url){if(!P(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((r,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return i(new Error("HTTP connection is missing or invalid"));r()})})}this.url=t,this.registering=!0;try{const n=F({id:1,jsonrpc:"2.0",method:"test",params:[]});await b(t,Object.assign(Object.assign({},M),{body:n})),this.onOpen()}catch(n){const r=this.parseError(n);throw this.events.emit("register_error",r),this.onClose(),r}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const n=typeof t.data=="string"?_t(t.data):t.data;this.events.emit("payload",n)}onError(t,n){const r=this.parseError(n),i=r.message||r.toString(),s=Ut(t,i);this.events.emit("payload",s)}parseError(t,n=this.url){return Dt(t,n,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>I&&this.events.setMaxListeners(I)}}export{at as A,ht as B,lt as C,vt as D,$ as E,ae as H,re as I,ce as J,Yt as a,it as b,gt as c,Zt as d,nt as e,ee as f,mt as g,F as h,oe as i,xt as j,se as k,_t as l,Ut as m,ie as n,ne as o,Dt as p,kt as q,V as r,te as s,Vt as t,jt as u,Q as v,K as w,Y as x,tt as y,ot as z};
